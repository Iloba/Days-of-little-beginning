function loadMap(){function f(n){$(".resultsPanel").html('<span class="errorMsg">'+n+"<\/span>")}function a(){u.clear();i.setOptions({visible:!1});$(".resultsPanel").html("")}function v(n,t){console.log("loc1 "+n);console.log("loc2 "+t);var i=Math.PI/180,r=n.latitude*i,o=n.longitude*i,u=t.latitude*i,s=t.longitude*i,h=u-r,c=s-o,f=Math.pow(Math.sin(h/2),2)+Math.cos(r)*Math.cos(u)*Math.pow(Math.sin(c/2),2),l=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),a=e=="km"?6378.1:3963.1676,v=a*l;return Math.round(v*100)/100}function r(n){a();var t={where:n,count:1,callback:function(n){console.log(n.results[0].location);n&&n.results&&n.results.length>0&&n.results[0].location?(console.log("Location in V8 "+n.results[0].location),p(n.results[0].location)):f("&nbsp;No results found for this criteria")},errorCallback:function(){f("Unable to geocode query")}};s.geocode(t)}function y(n){var i=window.location.href,r,t;return(i=i.toLowerCase(),n=n.replace(/[\[\]]/g,"\\$&"),r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),t=r.exec(i),!t)?null:t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):""}function p(n){var r=(100*1.6093).toFixed(4),i="select",s=l+"?spatialFilter=nearby("+n.latitude+","+n.longitude+","+r+")&$format=json&$top=50&key="+o;$.ajax({url:s,dataType:"jsonp",jsonp:"jsonp",success:function(r){var o=r.d.results,p,l,a,s,w,y,b,k;if(o.length>0){for(p=[],$(".c-progress").hide(),l=[],a=0,l.push("<div class='c-list'>"),s=0;s<o.length;s++){if(w="",y="",o[s].Name.match("^Microsoft Retail Store")||o[s].Name.match("^Microsoft Store")){if(w="#FF7F50",i!="store"&&i!="select")continue;y="store";a=a+1}else if(o[s].Name.match("^Microsoft Inovation Center")){if(w="#0078D7",i!="inovation-center"&&i!="select")continue;y="inovation-center";a=a+1}else{if(w="#2F2F2F",i!="office"&&i!="select")continue;y="office";a=a+1}o[s].type=y;o[s].index=a;b=new Microsoft.Maps.Location(o[s].Latitude,o[s].Longitude);k=new Microsoft.Maps.Pushpin(b,{icon:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="27" height="33" viewBox="0 0 30 37" xml:space="preserve"><polygon style="fill:{color};stroke-width:2;stroke:'+w+';" points="1,1 29,1 29,29 20,29 15,37 10,29 1,29 1,1"/><text x="15" y="20" style="font-size:16px;font-family:arial;fill:#000000;" text-anchor="middle">{text}<\/text><\/svg>',color:"#ffffff",text:a.toString()});k.Metadata=o[s];Microsoft.Maps.Events.addHandler(k,"click",function(n){h(n.target,"")});u.add(k);p.push(b);l.push('<div class="list-div" id="',y,'"><div>'+a+'.  <a id="lisitem-title" class="c-hyperlink" href="javascript:void(0);" rel="',o[s].ID,'">',o[s].Name,'<\/a> <b class="miles">',v(n,b)," ",e,"<\/b><\/div>");l.push("<div>",o[s].AddressLine,"<br/>",o[s].Locality,", ");l.push(o[s].AdminDistrict,", ",o[s].CountryRegion,"<br/>",o[s].PostalCode,"<\/div>");l.push('<div><a class="c-hyperlink" target="_blank" href="https://bing.com/maps/default.aspx?rtp=~pos.',o[s].Latitude,"_",o[s].Longitude,"_",encodeURIComponent(o[s].Name),'">View Directions <\/a>');y=="store"?l.push('<img src="https://c.s-microsoft.com/en-us/CMSImages/Shopping-Cart.png?version=e81eedbe-2b50-8798-0aa3-8655008b6cf4" width="20px" height="20px"  class="shopping-cart" >  <\/div>'):l.push("<\/div>");l.push("<\/div>")}l.push("<\/div>");l.length<=2&&l.push('<span class="errorMsg"> &nbsp;No results found for this criteria.<\/span>');p.length>1?t.setView({bounds:Microsoft.Maps.LocationRect.fromLocations(p),padding:80}):t.setView({center:p[0],zoom:15});$(".resultsPanel").html(l.join(""));$(".resultsPanel #lisitem-title").each(function(){$(this).click(function(){for(var i=$(this).attr("rel"),n,t=0;t<o.length;t++)if(n=u.getPrimitives()[t],n.Metadata.ID!=i)n=null;else break;n&&h(n,t+1)})});c()}else $(".c-progress").hide(),f("&nbsp; No results found for this search criteria")},error:function(n){f(n.statusText)}})}function h(n){var r="<div id='"+n.Metadata.type+"' class='infobox'><div class='infobox-header'>";r+="<a href='javascript:void(0);' onclick='closeInfoBox()' class='infobox-close'>";r+="X<\/a>";r+="<div class='field-data'><h5 class='c-heading-5'>"+n.Metadata.Name+"<\/h5><\/div><\/div>";r+="<div class='description'><div><div class='field-label'><img src='https://c.s-microsoft.com/en-us/CMSImages/address.png?version=9995488c-4fd7-bf24-1b1d-ccc75b9bc570' width='40px' height='40px'><\/div><div class='field-data'>";r+="<div>"+n.Metadata.AddressLine+"<\/div><div><\/div><div>"+n.Metadata.Locality+", "+n.Metadata.AdminDistrict+", "+n.Metadata.CountryRegion+" "+n.Metadata.PostalCode+"<\/div><\/div><\/div>";r+="<div><div class='field-label'><img src='https://c.s-microsoft.com//en-us/CMSImages/phone.png?version=dee0228f-ef88-ee74-d405-e62a7b9d5bba' width='19px' height='19px' style='margin-left:11px'><\/div><div class='field-data'>"+n.Metadata.Phone+"<\/div><\/div>";r+="<div><a href='https://bing.com/maps/default.aspx?rtp=~pos. "+n.Metadata.Latitude+"_"+n.Metadata.Longitude+"_"+encodeURIComponent(n.Metadata.Name)+"'>View Directions &gt;<\/a><\/div><\/div>";r+=n.Metadata.type=="inovation-center"?"<img src='https://c.s-microsoft.com/en-us/CMSImages/0078D7-info-box-arrow.png?version=efaade2f-a300-60c9-1275-3e3e77214e4c' class='infobox-arrow'>":n.Metadata.type=="store"?"<img src='https://c.s-microsoft.com/en-us/CMSImages/0078D7-info-box-arrow.png?version=db4c87bc-4c67-159e-e9cd-e55149f37cee' class='infobox-arrow'>":"<img src='https://c.s-microsoft.com/en-us/CMSImages/2F2F2F-info-box-arrow.png?version=be0e7fed-2040-71a1-fa74-02309b7236f2' class='infobox-arrow'>";r+="<\/div>";i.setOptions({visible:!0,htmlContent:r,offset:new Microsoft.Maps.Point(-158,68)});i.setLocation(n.getLocation());i.setMap(t);t.setView({center:n.getLocation()});window.closeInfoBox=function(){$(".infobox").remove()}}function c(){function n(n,t){t=="list"?($(n).addClass("active"),$(".map-view-link").removeClass("active"),$(".sidePanel").show(),$(".mapPanel").hide()):t=="map"&&($(n).addClass("active"),$(".list-view-link").removeClass("active"),$(".mapPanel").show(),$(".sidePanel").hide())}$(window).width()<=540?$(".resultsPanel .c-list").html()?($(".c-officelocator .view-links").show(),n(this,"list"),$(".list-view-link").click(function(){n(this,"list");$(".map-view-link").css("opacity","0.6");$(".list-view-link").css("opacity","1")}),$(".map-view-link").click(function(){n(this,"map");$(".list-view-link").css("opacity","0.6");$(".map-view-link").css("opacity","1")})):($(".c-officelocator .view-links").hide(),$(".mapPanel").hide(),$(".sidePanel").hide()):($(".c-officelocator .view-links").hide(),$(".sidePanel").show(),$(".mapPanel").show())}var l="https://spatial.virtualearth.net/REST/v1/data/faf94708899345ce851b5a3c016abd45/Belgium_LuxembourgOffices/Belgium_LuxembourgOffices",e="mi",t=new Microsoft.Maps.Map(document.getElementById("myMap"),{credentials:"W6gkikQMSrMJ2JDSOMGX~ZDb5nLNqHMpdNXV_OndodA~AgLLY6LOoZCKRTMfhO4D-RDE75eYMCx_3jHdMYzmhosC8H1g7JRsNi2MBvfl_d-m",zoom:4,center:new Microsoft.Maps.Location(50.85,4.36),mapTypeId:Microsoft.Maps.MapTypeId.road,disableKeyboardInput:!1}),u=new Microsoft.Maps.Layer,i,o,s,n;t.layers.insert(u);i=new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(0,0),{visible:!1,height:170,width:230});t.getCredentials(function(n){o=n});Microsoft.Maps.loadModule("Microsoft.Maps.Search",{callback:function(){s=new Microsoft.Maps.Search.SearchManager(t)}});$(window).resize(function(){$(window).width()>540?($(".resultsPanel").height($(window).height()-100),$(".mapPanel").height($(window).height()-100)):($(".resultsPanel").removeAttr("style"),$(".mapPanel").removeAttr("style"));c()});$(window).resize();$("#key-city-postalcode").keypress(function(n){n.which==13&&($("#key-state").val(""),r($("#key-city-postalcode").val()))});$("#key-state").keypress(function(n){n.which==13&&($("#key-city-postalcode").val(""),r($("#key-state").val()))});$("#search-type").change(function(){var t=$("#key-city-postalcode").val(),n=$("#key-state").val();(t!=""||n!="")&&(n!=""?r(n):r(t))});n=y("location");n!=null&&(n=n.replace(/%20/g," "),n!=""&&($(".c-progress").show(),n.length==4&&(n="0"+n),$("#key-city-postalcode").val(n),$(window).load(function(){r(n)})))}function loadMap(){function f(n){$(".resultsPanel").html('<span class="errorMsg">'+n+"<\/span>")}function a(){u.clear();i.setOptions({visible:!1});$(".resultsPanel").html("")}function v(n,t){var i=Math.PI/180,r=n.latitude*i,o=n.longitude*i,u=t.latitude*i,s=t.longitude*i,h=u-r,c=s-o,f=Math.pow(Math.sin(h/2),2)+Math.cos(r)*Math.cos(u)*Math.pow(Math.sin(c/2),2),l=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),a=e=="km"?6378.1:3963.1676,v=a*l;return Math.round(v*100)/100}function r(n){a();var t={where:n,count:1,callback:function(n){n&&n.results&&n.results.length>0&&n.results[0].location?p(n.results[0].location):f("&nbsp;No results found for this criteria")},errorCallback:function(){f("Unable to geocode query")}};s.geocode(t)}function y(n){var i=window.location.href,r,t;return(i=i.toLowerCase(),n=n.replace(/[\[\]]/g,"\\$&"),r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),t=r.exec(i),!t)?null:t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):""}function p(n){var r=(150*1.6093).toFixed(4),i=document.getElementById("search-type").value,s=l+"?spatialFilter=nearby("+n.latitude+","+n.longitude+","+r+")&$format=json&$top=50&key="+o;$.ajax({url:s,dataType:"jsonp",jsonp:"jsonp",success:function(r){var o=r.d.results,p,l,a,s,w,y,b,k;if(o.length>0){for(p=[],$(".c-progress").hide(),l=[],a=0,l.push("<div class='c-list'>"),s=0;s<o.length;s++){if(w="",y="",o[s].Name.match("^Microsoft Retail Store")||o[s].Name.match("^Microsoft Store")){if(w="#FF7F50",i!="store"&&i!="select")continue;y="store";a=a+1}else if(o[s].Name.match("^Microsoft Inovation Center")){if(w="#0078D7",i!="inovation-center"&&i!="select")continue;y="inovation-center";a=a+1}else{if(w="#2F2F2F",i!="office"&&i!="select")continue;y="office";a=a+1}o[s].type=y;o[s].index=a;b=new Microsoft.Maps.Location(o[s].Latitude,o[s].Longitude);k=new Microsoft.Maps.Pushpin(b,{icon:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="27" height="33" viewBox="0 0 30 37" xml:space="preserve"><polygon style="fill:{color};stroke-width:2;stroke:'+w+';" points="1,1 29,1 29,29 20,29 15,37 10,29 1,29 1,1"/><text x="15" y="20" style="font-size:16px;font-family:arial;fill:#000000;" text-anchor="middle">{text}<\/text><\/svg>',color:"#ffffff",text:a.toString()});k.Metadata=o[s];Microsoft.Maps.Events.addHandler(k,"click",function(n){h(n.target,"")});u.add(k);p.push(b);l.push('<div class="list-div" id="',y,'"><div>'+a+'.  <a id="lisitem-title" class="c-hyperlink" href="javascript:void(0);" rel="',o[s].ID,'">',o[s].Name,'<\/a> <b class="miles">',v(n,b)," ",e,"<\/b><\/div>");l.push("<div>",o[s].AddressLine,"<br/>",o[s].Locality,", ");l.push(o[s].AdminDistrict,", ",o[s].CountryRegion,"<br/>",o[s].PostalCode,"<\/div>");l.push('<div><a class="c-hyperlink" target="_blank" href="https://bing.com/maps/default.aspx?rtp=~pos.',o[s].Latitude,"_",o[s].Longitude,"_",encodeURIComponent(o[s].Name),'">View Directions <\/a>');y=="store"?l.push('<img src="https://c.s-microsoft.com/en-us/CMSImages/Shopping-Cart.png?version=e81eedbe-2b50-8798-0aa3-8655008b6cf4" width="20px" height="20px"  class="shopping-cart" >  <\/div>'):l.push("<\/div>");l.push("<\/div>")}l.push("<\/div>");l.length<=2&&l.push('<span class="errorMsg"> &nbsp;No results found for this criteria.<\/span>');p.length>1?t.setView({bounds:Microsoft.Maps.LocationRect.fromLocations(p),padding:80}):t.setView({center:p[0],zoom:15});$(".resultsPanel").html(l.join(""));$(".resultsPanel #lisitem-title").each(function(){$(this).click(function(){for(var i=$(this).attr("rel"),n,t=0;t<o.length;t++)if(n=u.getPrimitives()[t],n.Metadata.ID!=i)n=null;else break;n&&h(n,t+1)})});c()}else $(".c-progress").hide(),f("&nbsp; No results found for this search criteria")},error:function(n){f(n.statusText)}})}function h(n){var r="<div id='"+n.Metadata.type+"' class='infobox'><div class='infobox-header'>";r+="<a href='javascript:void(0);' onclick='closeInfoBox()' class='infobox-close'>";r+="X<\/a>";r+="<div class='field-data'><h5 class='c-heading-5'>"+n.Metadata.Name+"<\/h5><\/div><\/div>";r+="<div class='description'><div><div class='field-label'><img src='https://c.s-microsoft.com/en-us/CMSImages/address.png?version=9995488c-4fd7-bf24-1b1d-ccc75b9bc570' width='40px' height='40px'><\/div><div class='field-data'>";r+="<div>"+n.Metadata.AddressLine+"<\/div><div><\/div><div>"+n.Metadata.Locality+", "+n.Metadata.AdminDistrict+", "+n.Metadata.CountryRegion+" "+n.Metadata.PostalCode+"<\/div><\/div><\/div>";r+="<div><div class='field-label'><img src='https://c.s-microsoft.com//en-us/CMSImages/phone.png?version=dee0228f-ef88-ee74-d405-e62a7b9d5bba' width='19px' height='19px' style='margin-left:11px'><\/div><div class='field-data'>"+n.Metadata.Phone+"<\/div><\/div>";r+="<div><a href='https://bing.com/maps/default.aspx?rtp=~pos. "+n.Metadata.Latitude+"_"+n.Metadata.Longitude+"_"+encodeURIComponent(n.Metadata.Name)+"'>View Directions &gt;<\/a><\/div><\/div>";r+=n.Metadata.type=="inovation-center"?"<img src='https://c.s-microsoft.com/en-us/CMSImages/0078D7-info-box-arrow.png?version=efaade2f-a300-60c9-1275-3e3e77214e4c' class='infobox-arrow'>":n.Metadata.type=="store"?"<img src='https://c.s-microsoft.com/en-us/CMSImages/0078D7-info-box-arrow.png?version=db4c87bc-4c67-159e-e9cd-e55149f37cee' class='infobox-arrow'>":"<img src='https://c.s-microsoft.com/en-us/CMSImages/2F2F2F-info-box-arrow.png?version=be0e7fed-2040-71a1-fa74-02309b7236f2' class='infobox-arrow'>";r+="<\/div>";i.setOptions({visible:!0,htmlContent:r,offset:new Microsoft.Maps.Point(-158,68)});i.setLocation(n.getLocation());i.setMap(t);t.setView({center:n.getLocation()});window.closeInfoBox=function(){$(".infobox").remove()}}function c(){function n(n,t){t=="list"?($(n).addClass("active"),$(".map-view-link").removeClass("active"),$(".sidePanel").show(),$(".mapPanel").hide()):t=="map"&&($(n).addClass("active"),$(".list-view-link").removeClass("active"),$(".mapPanel").show(),$(".sidePanel").hide())}$(window).width()<=540?$(".resultsPanel .c-list").html()?($(".c-officelocator .view-links").show(),n(this,"list"),$(".list-view-link").click(function(){n(this,"list");$(".map-view-link").css("opacity","0.6");$(".list-view-link").css("opacity","1")}),$(".map-view-link").click(function(){n(this,"map");$(".list-view-link").css("opacity","0.6");$(".map-view-link").css("opacity","1")})):($(".c-officelocator .view-links").hide(),$(".mapPanel").hide(),$(".sidePanel").hide()):($(".c-officelocator .view-links").hide(),$(".sidePanel").show(),$(".mapPanel").show())}var l="https://spatial.virtualearth.net/REST/v1/data/af8a315fb81847628946aafc6963e2b1/CorporateOfficeStores/MicrosoftSalesOffices/",e="mi",t=new Microsoft.Maps.Map(document.getElementById("myMap"),{credentials:"Akc3VL2S4OzK8I1l0zkWDYeK6K30AcDc997Num5aHlz5A-4rJGnArLkZTrgv_asB",zoom:4,center:new Microsoft.Maps.Location(39.5,-98.35),mapTypeId:Microsoft.Maps.MapTypeId.road,disableKeyboardInput:!1}),u=new Microsoft.Maps.Layer,i,o,s,n;t.layers.insert(u);i=new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(0,0),{visible:!1,height:170,width:230});t.getCredentials(function(n){o=n});Microsoft.Maps.loadModule("Microsoft.Maps.Search",{callback:function(){s=new Microsoft.Maps.Search.SearchManager(t)}});$(window).resize(function(){$(window).width()>540?($(".resultsPanel").height($(window).height()-100),$(".mapPanel").height($(window).height()-100)):($(".resultsPanel").removeAttr("style"),$(".mapPanel").removeAttr("style"));c()});$(window).resize();$("#key-city-postalcode").keypress(function(n){n.which==13&&($("#key-state").val(""),r($("#key-city-postalcode").val()))});$("#key-state").keypress(function(n){n.which==13&&($("#key-city-postalcode").val(""),r($("#key-state").val()))});$(document).on("click",".select-map .c-menu-item",function(){var t=$("#key-city-postalcode").val(),n=$("#key-state").val();(t!=""||n!="")&&(n!=""?r(n):r(t))});n=y("location");n!=null&&(n=n.replace(/%20/g," "),n!=""&&($(".c-progress").show(),n.length==4&&(n="0"+n),$("#key-city-postalcode").val(n),$(window).load(function(){r(n)})))}$(window).load(function(){function t(n,t,i){var r,e,f,u;if(n!==undefined)return window.location===undefined?void 0:(r=null,e=null,t!==undefined&&t!==null&&(f=window.location.href,u={},u[t]=f,u.text=document.title,r=jQuery.param(u)),i!==undefined&&i!==null&&(r=r!==null?r+"&"+i:i),r!==null?n+"?"+r:n)}var n={};$(".scShareLink").click(function(){var r=$(this),o=r.data("action-endpoint-url"),s=r.data("page-url-parameter-name"),h=r.data("query-string"),e=r.data("window-options"),u=r.data("share-target-id"),f=t(o,s,h),i;return f===undefined?!1:(i=n[u],i===undefined||i===null||i.closed?(i=e===undefined||e===null?window.open(f,u):window.open(f,u,e),n[u]=i):i.location=f,i.focus(),!1)})});$(window).load(function(){var r=$("#LogoSearchInput"),n,t,u,i;r.attr("tabIndex",-1);n=$(".resultsPanel a");t=$(".mapPanel a");t.attr("tabindex",-1);n.attr("tabindex",-1);u=$(".LogoSearchGroup > *");$(".LogoContainer a").attr("tabindex",-1);i=window.location.href;window.focus(i)});$(window).load(function(){var r=$("#LogoSearchInput"),n,t,u,i;r.attr("tabIndex",-1);n=$(".resultsPanel a");t=$(".mapPanel a");t.attr("tabindex",-1);n.attr("tabindex",-1);u=$(".LogoSearchGroup > *");$(".LogoContainer a").attr("tabindex",-1);i=window.location.href;window.focus(i)})